<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <link type="text/css" rel="stylesheet" href="jspyder.css" />
    <script type="text/javascript" src="jspyder.js"></script>
    <script type="text/javascript" src="js-ajax.js"></script>
    <script type="text/javascript" src="js-dtype.js"></script>
    <script type="text/javascript" src="js-template.js"></script>
</head>

<body>
    <div id="test">This is a test div.</div>
    <div class="spread-3-1">
        <div>
            <label class="spread-3-1">Input Number</label class="spread-3-1">
            <input class="spread-3-2" id="input" />
        </div>
        <div>
            <label class="spread-3-1">BYTE</label class="spread-3-1">
            <input class="spread-3-2" id="out-byte" />
        </div>
        <div>
            <label class="spread-3-1">UBYTE</label class="spread-3-1">
            <input class="spread-3-2" id="out-ubyte" />
        </div>
        <div>
            <label class="spread-3-1">SHORT</label class="spread-3-1">
            <input class="spread-3-2" id="out-short" />
        </div>
        <div>
            <label class="spread-3-1">USHORT</label class="spread-3-1">
            <input class="spread-3-2" id="out-ushort" />
        </div>
        <div>
            <label class="spread-3-1">INT</label class="spread-3-1">
            <input class="spread-3-2" id="out-int" />
        </div>
        <div>
            <label class="spread-3-1">UINT</label class="spread-3-1">
            <input class="spread-3-2" id="out-uint" />
        </div>
        <div>
            <label class="spread-3-1">FLOAT</label class="spread-3-1">
            <input class="spread-3-2" id="out-float" />
        </div>
        <div>
            <label class="spread-3-1">DOUBLE</label class="spread-3-1">
            <input class="spread-3-2" id="out-double" />
        </div>
    </div>

    <br />
    <br />

    <script id="test-template" type="text/jspyder-template">
        <div class="my-template-div">
            @bold($name)
        </div>
    </script>

    <script type="text/javascript">
        js.dom("#input", function() {
                this.element(0, function() {
                    this.addEventListener("input", function() {
                        var value = this.value;
                        
                        js.dom("#out-byte").setAttrs({ "value": js.alg.byte(value) });
                        js.dom("#out-ubyte").setAttrs({ "value": js.alg.ubyte(value) });
                        js.dom("#out-short").setAttrs({ "value": js.alg.short(value) });
                        js.dom("#out-ushort").setAttrs({ "value": js.alg.ushort(value) });
                        js.dom("#out-int").setAttrs({ "value": js.alg.int(value) });
                        js.dom("#out-uint").setAttrs({ "value": js.alg.uint(value) });
                        js.dom("#out-float").setAttrs({ "value": js.alg.float(value) });
                        js.dom("#out-double").setAttrs({ "value": js.alg.double(value) });
                    });
                });
            });
            
            js.dom("#test", function() {
                this.element(0, function() {
                    this.addEventListener("mousedown", function() { console.log("mousedown"); }, true, true); 
                });
            });
            js.dom("<button>Click Me to Click Text</button>").attach(document.body).element(0, function() {
                this.addEventListener("mousedown", function() {
                    js.dom("#test").element(0, function() {
                        var e;
                        try {
                            e = new Event("mousedown", {"bubbles": true, "cancelable": false});
                        }
                        catch(_) {
                            e = document.createEvent("Event");
                            e.initEvent("mousedown", true, true);
                        } 
                        
                        js.dom("#test").element(0, function() {
                            this.dispatchEvent(e);
                        });
                    });
                });
            });

var o = {};
js.dtype(o)
    .ubyte("ubyte", 0)
    .ubyte("subyte", 0, true)
    .ubyte("cubyte", 0, false, true)
    .ubyte("scubyte", 0, true, true)
    .uchar("uchar", 63)
    .uchar("suchar", 63, true)
    .uchar("cuchar", 63, false, true)
    .uchar("scuchar", 63, true, true)
    .string("string", "string")
    .string("sstring", "string", true)
    .string("cstring", "string", false, true)
    .string("scstring", "string", true, true)

            var template = document.querySelector("#test-template").innerHTML;
            
            var values = {
                name: "Steven Jimenez"
            };
            var functions = {
                bold: function(name) {
                    return "<b>" + name + "</b>"; 
                }
            };
            
            function parseValue($var) {
                if($var.charAt(0) !== "$") {
                    return $var;
                }
                $var = $var.substring(1);
                if(values.hasOwnProperty($var)) {
                    return values[$var];
                }
                throw new Error("JSpyder Template could not find value for " + $var + " in value library; returning a blank string, instead.");
                return ""; 
            }
            
            function parseFn(_fn, args) {
                if(functions.hasOwnProperty(_fn)) {
                    var ret = functions[_fn].apply(values, args);
                    return typeof ret === "undefined" ? "" : ret;
                }
                throw new Error("JSpyder Template could not find function " + $var + " in library; returning a blank string, instead.");
                return "";
            }
            
            function parseTemplate(tmp) {
                var fnStack, fnName, fnArgs, fnResult;
                while(fnStack = tmp.match(/@(.+)\((?:(.*),?)*\)/)) { 
                    fnName = fnStack[1];
                    fnArgs = fnStack.slice(2);
                    for(var i = 0; i < fnArgs.length; i++) {
                        fnArgs[i] = parseValue(fnArgs[i]);
                    }
                    fnResult = parseFn(fnName, fnArgs);
                    tmp = tmp.replace(/@(.+)\((?:(.*),?)*\)/, fnResult);
                }
                
                return tmp;
            }
            
            function insertTemplate(location, tmp) {
                js.dom(location).item(0, function() {
                    tmp = parseTemplate(tmp);
                    this.append(tmp);
                });
            }
    </script>
</body>

</html>