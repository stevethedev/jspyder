<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" /> 
        <link type="text/css" rel="stylesheet" href="jspyder.css" />
        <script type="text/javascript" src="jspyder.js" ></script>
    </head>
    <body>
        <div id="test">This is a test div.</div>
        <label>Input Number</label>
        <input id="input" />
        <label>BYTE</label>
        <input id="out-byte" />
        <label>UBYTE</label>
        <input id="out-ubyte" />
        <label>SHORT</label>
        <input id="out-short" />
        <label>USHORT</label>
        <input id="out-ushort" />
        <label>INT</label>
        <input id="out-int" />
        <label>UINT</label>
        <input id="out-uint" />
        <label>FLOAT</label>
        <input id="out-float" />
        <label>DOUBLE</label>
        <input id="out-double" />
        <br />
        <br />
        
        <script id="test-template" type="text/jspyder-template">
            <div class="my-template-div">
                @bold($name)
            </div>
        </script>
        
        <script type="text/javascript">
            js.dom("#input", function() {
                this.element(0, function() {
                    this.addEventListener("input", function() {
                        var value = this.value;
                        
                        js.dom("#out-byte").setAttrs({ "value": js.alg.byte(value) });
                        js.dom("#out-ubyte").setAttrs({ "value": js.alg.ubyte(value) });
                        js.dom("#out-short").setAttrs({ "value": js.alg.short(value) });
                        js.dom("#out-ushort").setAttrs({ "value": js.alg.ushort(value) });
                        js.dom("#out-int").setAttrs({ "value": js.alg.int(value) });
                        js.dom("#out-uint").setAttrs({ "value": js.alg.uint(value) });
                        js.dom("#out-float").setAttrs({ "value": js.alg.float(value) });
                        js.dom("#out-double").setAttrs({ "value": js.alg.double(value) });
                    });
                });
            });
            
            js.dom("#test", function() {
                this.element(0, function() {
                    this.addEventListener("mousedown", function() { console.log("mousedown"); }, true, true); 
                });
            });
            js.dom("<button>Click Me to Click Text</button>").attach(document.body).element(0, function() {
                this.addEventListener("mousedown", function() {
                    js.dom("#test").element(0, function() {
                        var e;
                        try {
                            e = new Event("mousedown", {"bubbles": true, "cancelable": false});
                        }
                        catch(_) {
                            e = document.createEvent("Event");
                            e.initEvent("mousedown", true, true);
                        } 
                        
                        js.dom("#test").element(0, function() {
                            this.dispatchEvent(e);
                        });
                    });
                });
            });

            var template = document.querySelector("#test-template").innerHTML;
            
            var values = {
                name: "Steven Jimenez"
            };
            var functions = {
                bold: function(name) {
                    return "<b>" + name + "</b>"; 
                }
            };
            
            function parseValue($var) {
                if($var.charAt(0) !== "$") {
                    return $var;
                }
                $var = $var.substring(1);
                if(values.hasOwnProperty($var)) {
                    return values[$var];
                }
                throw new Error("JSpyder Template could not find value for " + $var + " in value library; returning a blank string, instead.");
                return ""; 
            }
            
            function parseFn(_fn, args) {
                if(functions.hasOwnProperty(_fn)) {
                    var ret = functions[_fn].apply(values, args);
                    return typeof ret === "undefined" ? "" : ret;
                }
                throw new Error("JSpyder Template could not find function " + $var + " in library; returning a blank string, instead.");
                return "";
            }
            
            function parseTemplate(tmp) {
                var fnStack, fnName, fnArgs, fnResult;
                while(fnStack = tmp.match(/@(.+)\((?:(.*),?)*\)/)) { 
                    fnName = fnStack[1];
                    fnArgs = fnStack.slice(2);
                    for(var i = 0; i < fnArgs.length; i++) {
                        fnArgs[i] = parseValue(fnArgs[i]);
                    }
                    fnResult = parseFn(fnName, fnArgs);
                    tmp = tmp.replace(/@(.+)\((?:(.*),?)*\)/, fnResult);
                }
                
                return tmp;
            }
            
            function insertTemplate(location, tmp) {
                js.dom(location).item(0, function() {
                    tmp = parseTemplate(tmp);
                    this.append(tmp);
                });
            }
        </script>
    </body>
</html>