<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js">/* ****************************************************************************
 * The MIT License (MIT)
 *
 * Copyright (c) 2015 Steven Jimenez
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the &quot;Software&quot;), to 
 * deal in the Software without restriction, including without limitation the 
 * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or 
 * sell copies of the Software, and to permit persons to whom the Software is 
 * furnished to do so, subject to the following conditions:
 *  
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR 
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, 
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE 
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER 
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING 
 * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
 * IN THE SOFTWARE.
 * ***************************************************************************/

jspyder.extend.fn(&quot;form&quot;, function () {
    var js = this;
    
<span id='jspyder-form'>    /**
</span>     * @class jspyder.form
     * @member jspyder
     * 
     * Initializes a JSpyder Form object.
     * 
     * @param {Object} [config]
     *      Configuration flags for building the forms element.
     * 
     * @param {Function} [config.success]
     *     Function to trigger on form submission, if the validation
     *     checks pass.  This can be overridden, later.  Expected
     *     parameters are:
     * 
     * @param {Object} [config.success.values]
     *     The values of each field in the form, where keys correspond
     *     to field names and values correspond to their values.
     * 
     * @param {Function} [config.failure]
     *     Function to trigger on form submission failure. For example,
     *     if the validation checks failed.  This can be overridden, 
     *     later.
     *      
     * @param {Object} [config.failure.values]
     *     The values of each field in the form, where keys correspond
     *     to field names and values correspond to their values.
     * 
     * @param {Object} [config.failure.invalid]
     *     The values of each invalid field in the form, where keys
     *     correspond to field names and values correspond to their
     *     values.
     * 
     * @param {Function} [config.reset]
     *     Function to trigger on form rest.  This can be overridden, 
     *     later.
     * 
     * @return {Object}
     *      JSpyder Function object.
     */
    function js_form(config, fn) {
        var form = Object.create(js_form.fn, {
            _dom: { value: js.dom(&quot;&lt;form&gt;&lt;/form&gt;&quot;) },
            _template: { value: {} }
        });
        
        // load in the configuration options
        if (config) {
            // success function
            if (config.success) { form._success = config.success; }
            // failure function
            if (config.failure) { form._failure = config.failure; }
            // reset function
            if (config.reset) { form._reset = config.reset; }
            // form elements
            if (config.elements) {
                form.addFields(config.elements);
            }
        }

        if (typeof fn === &quot;function&quot;) {
            fn.apply(this);
        }

        return form;
    }

    js_form.fn = {
<span id='jspyder-form-method-_submit'>        /**
</span>         * @private
         * @method
         * 
         * Callback function which will execute if the form submits
         * successfully.
         * 
         * @param {Object} values
         *      An object where keys correspond to input names, and values
         *      correspond to the values they are storing.
         */
        _submit: function (values, invalid) { return this; },
        
<span id='jspyder-form-method-_failed'>        /**
</span>         * @private
         * @method
         * 
         * Callback function which will execute if the form fails to submit
         * successfully (e.g. failed the validation check). 
         * 
         * @param {Object} values
         *      An object where keys correspond to input names, and values
         *      correspond to the values they are storing.
         * 
         * @param {Object} invalid
         *      An object of invalid fields where keys correspond to input
         *      names, and values correspond to the values they are storing.
         */
        _failed: function (values, invalid) { return this; },
        
<span id='jspyder-form-method-_reset'>        /**
</span>         * @private
         * @method
         * 
         * Callback function which will execute if the reset event is received.
         */
        _reset: function () { return this; },
        
<span id='jspyder-form-property-_dom'>        /**
</span>         * @private
         * @property {Object}
         * 
         * jspyder.dom object pointing to the created form element.
         */
        _dom: null,
        
<span id='jspyder-form-property-_fields'>        /**
</span>         * @private
         * @property {Object}
         * 
         * List of elements that the form is dealing with, to prevent having to
         * deal directly with making calls to the DOM.
         */
        _fields: null,
        
<span id='jspyder-form-method-addFields'>        /**
</span>         * @method
         * Adds a group of fields using jspyder.form.addField where keys
         * correspond to field names and values correspond to field templates.
         * 
         * @param {Object} fields
         */
        
        addFields: function(fields) {
            for (var name in fields) {
                this.addField(name, fields[name])
            }
            return this;
        },
        
<span id='jspyder-form-method-addField'>        /**
</span>         * @method
         * 
         * Adds a new field to the form, if the name does not already exist,
         * using the name provided.
         * 
         * @param {String} name
         *      The name which will be used to refer to the generated field.
         * 
         * @param {Object} [config]
         *      The configuration options which will be used to generate and
         *      style the created field.
         * 
         * @param {String} [config.type]
         *      The type of field which should be created:
         *      - **input** *default*: standard input field without
         *          any special attributes or constraints.
         *      - **checkbox**: A set of checkboxes will be created.  Each value
         *          should be designated with label-value pairs stored in an
         *          array (see below).
         *      - **dropdown**: A dropdown control will be created.  Each value
         *          should be designated with label-value pairs stored in an
         *          array (see below).
         *      - **textarea**: A standard multi-line text field.
         *      - **hidden**: An abstract field which is not rendered to the
         *          page, but in all other ways behaves like a standard *input*
         *          field.
         * 
         * @param {Object[]} [config.values]
         *      A list of text-value pairs.
         * 
         * @param {String} [config.values.label]
         *      The label to display in place of the value.  If this is omitted,
         *      and a value is provided, then this will default to the value.
         * 
         * @param {String} [config.values.value]
         *      The value for this particular option.  If this is omitted, and
         *      a label is provided, then this will default to the label.
         * 
         * @param {String} [config.section]
         *      The name of a section to add this particular field to.  If
         *      blank, then this field is not added directly to the list.
         */
        addField: function (name, config) {
            var $field = js.dom(),
                cfg = Object.create(js_form.fn.fieldTemplate),
                option, i;
            
            // copy all of the config options over, if they exist.    
            js.alg.mergeObj(cfg, config);
            if (config.values) { cfg.values = js.alg.sliceArray(config.values); }

            switch (cfg.type) {
                // case &quot;section&quot;:
                //     break;
                    
                case &quot;checkbox&quot;:
                    // js.alg.each(cfg.values, this._createCheckboxes, { $field: $field, cfg: cfg, name: name });
                    for (i = 0; i &lt; config.values.length; i++) {
                        option = config.values[i];
                        $field.and(
                            &quot;&lt;input value=\&quot;&quot; + (option.value || option.text) +
                            &quot;\&quot; name=\&quot;&quot; + name + &quot;\&quot; type=\&quot;checkbox\&quot; /&gt;&quot; +
                            &quot;&lt;label&gt;&quot; + (option.text || option.value) + &quot;&lt;/label&gt;&quot;);
                    }
                    break;

                case &quot;textarea&quot;:
                    $field.and(&quot;&lt;textarea name=\&quot;&quot; + name + &quot;\&quot; &gt;&quot;);
                    break;

                case &quot;dropdown&quot;:
                case &quot;hidden&quot;:
                case &quot;input&quot;:
                default:
                    $field.and(&quot;&lt;input name=\&quot;&quot; + name + &quot;\&quot;&gt;&lt;/input&gt;&quot;);

                    if (cfg.type === &quot;hidden&quot;) {
                        $field.setCss({ &quot;display&quot;: &quot;none !important&quot; });
                    }

                    if (cfg.type === &quot;dropdown&quot;) {
                        // do dropdown stuff
                    }

                    if (cfg.type === &quot;autocomplete&quot;) {
                        // do autocomplete stuff (similar to dropdown)
                    }

                    break;
            }

            if (!this._fields) {
                this._fields = {};
            }
            this._fields[name] = { type: cfg.type, field: $field, section: config.section || null };

            return this;
        },

<span id='jspyder-form-method-'>        /**
</span>         * @private
         * @method
         * 
         * Constructor for creating a series of checkbox elements.  These are
         * added sequentially.
         * 
         * @param {Object} option
         * @param {String} [option.text] Label for checkbox element
         * @param {String} [option.value] Value to set for the checkbox element
         * @param {Number} index The ID number for the current option
         * @param {Object[]} options Array of options being iterated
         * @param {Object} context
         * @param {String} context.name The name these fields will be stored under.
         * @param {Object} context.$field JSpyder DOM the checkboxes are being added to.
         */
        // _createCheckboxes: function (option, index, options, context) {
        //     var $field = context.$field,
        //         name = context.name;

        //     $field.and(
        //         &quot;&lt;input value=\&quot;&quot; + (option.value || option.text) +
        //         &quot;\&quot; name=\&quot;&quot; + name + &quot;\&quot; type=\&quot;checkbox\&quot; /&gt;&quot; +
        //         &quot;&lt;label&gt;&quot; + (option.text || option.value) + &quot;&lt;/label&gt;&quot;);
        // },

<span id='jspyder-form-method-values'>        /**
</span>         * @method
         * 
         * Retrieves the values of all of the elements in the JS-Form.
         * 
         * @param {Function} fn
         *      A callback function to execute after the values have been
         *      calculated.  The context points back to the js-form.
         * @param {Object} fn.values
         *      The values of all of the form elements are pushed into the
         *      first parameter of the function fn.
         */
        values: function (fn) {
            var values = {};
            // js.alg.each(this._fields, this._values, { self: this, values: values });
            
            var $field, $type, name;
            for (name in this._fields) {
                $field = this._fields[name].field;
                $type = this._fields[name].type;
                values[name] = null;

                switch ($type) {
                    case &quot;checkbox&quot;:
                        values[name] = self._checkboxValue($field);
                        break;
                    default:
                        values[name] = self._genericValue($field);
                        break;
                }
            }
                
            fn.apply(this, [values]);
            return this;
        },
        
<span id='jspyder-form-method-'>        /**
</span>         * @private
         * @method
         * 
         * Logical loop for jspyder.form.values; separated from the main
         * function for efficient memory-management.
         * 
         * @param {Object} fieldSet
         *      A pair of values being pushed in from jspyder.form._fields
         * 
         * @param {String} fieldSet.type
         *      The type of element being created.
         * 
         * @param {Object} fieldSet.field
         *      A reference to the JS-DOM object containing the form fields.
         * 
         * @param {String} name
         *      The name of the current field in the iterator.
         * 
         * @param {Object} fields
         *      Reference to jspyder.form._fields
         * 
         * @param {Object} context
         * @param {Object} context.values
         *      Reference to the field values which are being returned by
         *      jspyder.form.values
         * 
         * @param {Object} context.self
         *      JS-Form
         */
        // _values: function (fieldSet, name, fields, context) {
        //     var self = context.self,
        //         values = context.values,
        //         $field = fieldSet.field,
        //         $type = fieldSet.type;
                
        //     values[name] = null;
                
        //     switch ($type) {
        //         case &quot;checkbox&quot;:
        //             values[name] = self._checkboxValue($field);
        //             break;
        //         default:
        //             values[name] = self._genericValue($field);
        //             break;
        //     }
            
        //     return;
        // },
        
<span id='jspyder-form-method-_genericValue'>        /**
</span>         * @method
         * @private
         * 
         * Uses a generic value-retrieval method; this should be sufficient for
         * most single-value controls (e.g. not checkboxes)
         * 
         * @param {Object} $input
         *      JS-DOM object to retrieve a value from.
         * 
         * @return {String}
         *      The value of the element.
         */
        _genericValue: function ($input) {
            var value = &quot;&quot;;
            
            if ($input) {
                $input.element(0, function () {
                    value = this.value;
                    if (typeof value === &quot;undefined&quot; || value === null) {
                        value = &quot;&quot;;
                    }
                });
            }
            
            return value;
        },

<span id='jspyder-form-method-_checkboxValue'>        /**
</span>         * @method
         * @private
         * 
         * Specialized value retrieval for checkbox elements.
         */
        _checkboxValue: function ($checkboxes) {
            var value = [];
                
            if ($checkboxes) {
                $checkboxes.each(function (checkbox) {
                    if ((checkbox instanceof HTMLInputElement)
                        &amp;&amp; (checkbox.getAttribute(&quot;type&quot;) === &quot;checkbox&quot;)
                        &amp;&amp; (checkbox.checked)) {
                        value.push(checkbox.value);
                    }
                });
            }
            
            return value;
        },
        
        fieldTemplate: {
            type: &quot;input&quot;,
            values: [],
        },
        
<span id='jspyder-form-method-submit'>        /**
</span>         * @method
         * 
         * Triggers a manual form submission.  If the form fails validation, or
         * any other errors occur, then the failed callback is executed.  
         * Otherwise, the success function is executed.
         * 
         * @param {Function} [onSuccess]
         *      Overrides the success function provided in the configuration on
         *      construction.  See jspyder.form constructor for expected 
         *      parameters.
         * 
         * @param {Function} [onFail]
         *      Overrides the failure function provided in the configuration on
         *      construction.  See jspyder.form constructor for expected 
         *      parameters.
         */
        submit: function(onSuccess, onFail) {
            return this;
        },
        
<span id='jspyder-form-method-reset'>        /**
</span>         * @method
         * 
         * Triggers a manual form reset.  This will turn all of the form fields
         * back to their initial values on creation.
         * 
         * @param {Function} [fn]
         *      Optional callback to execute after the reset has been completed.
         *      See jspyder.form constructor for expected parameters.
         */
        reset: function(fn) {
            return this;
        },
        
<span id='jspyder-form-method-validate'>        /**
</span>         * @method
         * 
         * Triggers a manual form reset.  This will turn all of the form fields
         * back to their initial values on creation.
         * 
         * @param {Function} [fn]
         *      Optional callback to execute after the validation has been 
         *      completed.  See jspyder.form constructor for expected 
         *      parameters.
         */
        validate: function(fn) {
            return this;
        },
        
<span id='jspyder-form-method-attach'>        /**
</span>         * @method
         * Attaches the form to the specified dom node
         * 
         * @param {Function} [fn]
         *      Optional callback function to execute, using the form js.dom
         *      element as the context and the js.form object as the first
         *      parameter.
         * 
         * @param {Object} [fn.dom] 
         *      DOM node created and attached to the document.
         * 
         * @param {Mixed} [fn.data]
         *      Data parameter passed into the function.
         * 
         * @param {Mixed} [data]
         *      Optional parameter to pass in as a second parameter for [fn].
         * 
         * @return {Object} js.dom object.
         */
        attach: function (fn, data) {
            var dom = this._dom,
                fields = this._fields,
                name, group, section;
                
            for (name in fields) {
                group = fields[name];
                // group{ type, field, section }
            }
            
            // cycle through fields
            
            if(typeof fn === &quot;function&quot;) {
                fn.apply(dom, [this, dom, data]);
            }
            
            return this; 
        },
    };
    
    
     
    return js_form;
 });</pre>
</body>
</html>
